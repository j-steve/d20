extends ./layout

block styles
	style.
		.modal-body .list-group-item {
			cursor:pointer;
		}
		.modal-footer .btn {visibility:hidden;}
		.modal-footer.show-button .btn {visibility:invisible;}
		.modal-footer.show-button .btn {visibility:visible;}
		.modal-footer.show-button .message {display:none;}

block content
	h2 Select a #{title}:
	div.row
		for ddclass in ddclasses
			div.col-sm-4.col-md-2
				div.thumbnail(data-name=ddclass.name)
					img(src=ddclass.image, alt="...", style="height:300px;")
					div.caption
					h3=ddclass.name
					p(style="height:200px;")=ddclass.description
					p
						input(type="button", value="Choose " + ddclass.name).btn.btn-primary
					.decision-dialogs
						for decision in ddclass.decisions
							.modal.fade(data-count=decision.count, role="dialog"): .modal-dialog(role="document"): .modal-content
								.modal-header
									button.close(type="button", data-dismiss="modal", aria-label="Close"): span(aria-hidden="true") &times;
									h3.modal-title Select #{decision.name}
								.modal-body
									.list-group
										for option in decision.options
											a.list-group-item
												h4.list-group-item-heading #{option.name}
												p.list-group-item-text #{option.description}
								.modal-footer
									button(type="button").btn.btn-primary="Continue"
									span.message Select <span class="deficitCount">#{decision.count}</span> more to continue.
										

append scripts
	script.
		$(function() {
			$('input[type=button]').on('click', function() {
				var $dialogs = $(this).parents('.thumbnail').find('.decision-dialogs').children();
				if ($dialogs.length) {
					$dialogs.eq(0).modal('show');
				} else {
					nextPage($(this));
				}
			});
			
			$('.modal-body .list-group-item').on('click', function() {
				if (!$(this).hasClass('disabled')) {
					$(this).toggleClass('active');
					const $modal = $(this).parents('.modal');
					const $items = $modal.find('.list-group-item');
					const deficitCount = $modal.data('count') - $items.filter('.active').length;
					$items.not('.active').toggleClass('disabled', deficitCount <= 0);
					$modal.find('.modal-footer').toggleClass('show-button', deficitCount <= 0).find('.deficitCount').text(deficitCount);
				}
			});
			
			$('.modal-footer .btn').on('click', function() {
				if (!$(this).hasClass('disabled')) {
					const $modal = $(this).parents('.modal');
					$modal.modal('hide');
					nextPage($modal);
				}
			});
			
			function nextPage($target) {
				const ddClass = $target.parents('.thumbnail').data('name');
				location.href = '!{nextPage}' + ddClass;
			}
		});
	